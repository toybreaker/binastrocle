---
import { getCollection, getEntry } from 'astro:content';
import WorkImage from '@components/WorkImage.astro';

export async function getStaticPaths() {
  const works = await getCollection('works');
  return works.map((work) => ({
    params: { slug: work.id },
    props: { work },
  }));
}

const { work } = Astro.props;
const { Content } = await work.render();

// Build image paths based on the hash and images array
const getImagePath = (imageNumber: number) => {
  const paddedNumber = imageNumber.toString().padStart(2, '0');
  return `assets/p/${work.data.hash}/${work.data.hash}-${paddedNumber}-1024.jpg`;
};
---

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <title>{work.data.title}</title>
  <meta name="description" content={work.data.description} />
</head>

<body>
  <h1>{work.data.title}</h1>
  <p>{work.data.description}</p>
  <span>{work.data.project}</span>

  <Content />

  <!-- Main image -->
  <WorkImage
    src={work.data.image}
    alt={`${work.data.title} - Main image`}
    index={0}
  />

  <!-- Additional images from the images array -->
  {work.data.images && work.data.images.map((imageNumber, index) => (
    <WorkImage
      src={getImagePath(imageNumber)}
      alt={`${work.data.title} - Image ${index + 1}`}
      index={index + 1}
    />
  ))}
</body>
</html>
