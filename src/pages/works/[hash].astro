---
// src/pages/works/[hash].astro
import { getCollection, render } from 'astro:content';
import Layout from '@layouts/Layout.astro';
import { getWorkImagesSync } from '@utils/imageUtils';

// Generate routes for all works
export async function getStaticPaths() {
  const works = await getCollection('works');

  return works.map((work) => ({
    params: {
      hash: work.data.hash,
    },
    props: { work },
  }));
}

const { work } = Astro.props;
const { Content } = await render(work);

// Get all images for this work automatically
const imageUrls = getWorkImagesSync(work.data.hash);
const firstImage = imageUrls[0];
const remainingImages = imageUrls.slice(1);
---

<Layout title={work.data.title}>
  <div class='bungkus'>
    <div class='header'>
      <div class='go_home'>
        <a href='/'>
          <!-- Your logo SVG here -->
          <svg><!-- binocle logo --></svg>
        </a>
      </div>
    </div>

    <div class='text_content'>
      <!-- Display first image before h2 title -->
      {
        firstImage && (
          <div class='image_wrap'>
            <img src={firstImage} alt={`${work.data.title} - Featured Image`} loading='lazy' />
          </div>
        )
      }

      <h2 class='work_name'>{work.data.project}</h2>

      <div class='intro'>
        <Content />
      </div>

      <!-- Display remaining images after text content -->
      {
        remainingImages.map((imageUrl, index) => (
          <div class='image_wrap'>
            <img src={imageUrl} alt={`${work.data.title} - Image ${index + 2}`} loading='lazy' />
          </div>
        ))
      }

      {imageUrls.length === 0 && <p>No images found for this work.</p>}
    </div>
  </div>
</Layout>
