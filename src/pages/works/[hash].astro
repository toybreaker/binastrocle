---
// src/pages/works/[hash].astro
import { getCollection, render } from 'astro:content';
import { getWorkImagesSync } from '@utils/imageUtils';
import Layout from '@layouts/Layout.astro';
import { Picture } from 'astro:assets';

// Generate routes for all works
export async function getStaticPaths() {
  const works = await getCollection('works');

  return works.map((work) => ({
    params: {
      hash: work.data.hash,
    },
    props: { work },
  }));
}

const { work } = Astro.props;
const { Content } = await render(work);

// Get all images for this work automatically
const imageUrls = getWorkImagesSync(work.data.hash);
const firstImage = imageUrls[0];
const remainingImages = imageUrls.slice(1);
---

<Layout title={work.data.title}>
    <div class={'bungkus ' + work.data.project}>
    <!-- Display first image before h2 title -->
    {
      firstImage && (
        <div class='image_wrap'>
            <Picture src={firstImage} alt="dhsb" />
        </div>
      )
    }

    <h2 class='work_name'>{work.data.project}</h2>

    <section class='text_content intro'>
      <Content />
    </section>

    <!-- For remaining images, use Picture component too -->
    <section class='image_content'>
        {
            remainingImages.map((imageObj, index) => (
            <div class='image_wrap'>
                <Picture src={imageObj} alt={`${work.data.title} - Image ${index + 2}`} loading='lazy' />
            </div>
            ))
        }

        {imageUrls.length === 0 && <p>No images found for this work.</p>}
    </section>
  </div>

</Layout>
